<!doctype html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>‡∏à‡∏≠‡∏á‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‚Äî SPC Academy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: { thai: ["'Sarabun'", "sans-serif"] },
            colors: {
              brand: { DEFAULT: "#6C3FC9", light: "#EDE9FF", dark: "#4B2BA3" },
              accent: { DEFAULT: "#F9A826", light: "#FFF3D6" },
            },
          },
        },
      };
    </script>
    <link
      href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Sarabun", sans-serif;
      }
      .day-btn:disabled {
        opacity: 0.25;
        cursor: not-allowed;
      }
      .day-btn:not(:disabled):hover {
        background: #ede9ff;
        color: #6c3fc9;
      }
      .booking-badge {
        font-size: 0.5rem;
        background: #f9a826;
        color: #fff;
        border-radius: 9999px;
        padding: 0 4px;
        line-height: 1.6;
        min-width: 14px;
        text-align: center;
        font-weight: 700;
      }
      .day-btn.selected {
        background: #6c3fc9 !important;
        color: #fff !important;
      }
      .day-btn.today-mark {
        border: 2px solid #f9a826;
      }
      .glass {
        background: rgba(255, 255, 255, 0.85);
        backdrop-filter: blur(14px);
        -webkit-backdrop-filter: blur(14px);
      }
      input:focus,
      select:focus {
        outline: none;
        box-shadow: 0 0 0 3px rgba(108, 63, 201, 0.25);
      }
      .fade-in {
        animation: fadeIn 0.4s ease both;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(12px);
        }
        to {
          opacity: 1;
          transform: none;
        }
      }
      .toast {
        position: fixed;
        bottom: 1.5rem;
        right: 1.5rem;
        z-index: 9999;
        transition: all 0.4s;
        transform: translateY(0);
        opacity: 1;
      }
      .toast.hide {
        transform: translateY(30px);
        opacity: 0;
      }
      /* ‚îÄ‚îÄ Loading spinner ‚îÄ‚îÄ */
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
      .spinner {
        width: 28px;
        height: 28px;
        border: 3px solid #ede9ff;
        border-top-color: #6c3fc9;
        border-radius: 50%;
        animation: spin 0.7s linear infinite;
        display: inline-block;
      }
      .loading-overlay {
        position: absolute;
        inset: 0;
        background: rgba(255, 255, 255, 0.75);
        backdrop-filter: blur(3px);
        border-radius: 0.75rem;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        z-index: 10;
        transition: opacity 0.25s;
      }
      .loading-overlay.hide {
        opacity: 0;
        pointer-events: none;
      }
      .skeleton {
        background: linear-gradient(
          90deg,
          #ede9ff 25%,
          #d8d0f7 50%,
          #ede9ff 75%
        );
        background-size: 200% 100%;
        animation: shimmer 1.2s infinite;
        border-radius: 0.75rem;
        height: 2.4rem;
      }
      @keyframes shimmer {
        to {
          background-position: -200% 0;
        }
      }
    </style>
  </head>
  <body
    class="min-h-screen bg-gradient-to-br from-brand-light via-white to-accent-light"
  >
    <!-- ‚îÄ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ‚îÄ -->
    <header class="bg-brand shadow-lg">
      <div class="max-w-5xl mx-auto px-4 py-4 flex items-center gap-3">
        <div
          class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center text-white text-xl"
        >
          ü§∏
        </div>
        <div>
          <h1 class="text-white font-bold text-xl leading-tight">Academy</h1>
          <p class="text-white/70 text-xs">‡∏à‡∏≠‡∏á‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏õ‡∏≤‡∏£‡πå‡∏Å‡∏±‡∏ß & ‡∏¢‡∏¥‡∏°‡∏ô‡∏±‡∏™‡∏ï‡∏¥‡∏Å</p>
        </div>
      </div>
    </header>

    <!-- ‚îÄ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ‚îÄ -->
    <main class="max-w-5xl mx-auto px-4 py-8 fade-in">
      <!-- success banner (hidden by default) -->
      <div
        id="successBanner"
        class="hidden mb-6 bg-green-50 border border-green-300 text-green-800 rounded-xl px-5 py-4 flex items-center gap-3"
      >
        <span class="text-2xl">‚úÖ</span>
        <div>
          <p class="font-semibold">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</p>
          <p class="text-sm">
            ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏ó‡πà‡∏≤‡∏ô‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡πÉ‡∏ô Google Sheet ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß
          </p>
        </div>
      </div>

      <div class="grid md:grid-cols-2 gap-8">
        <!-- ‚îÄ‚îÄ‚îÄ LEFT: CALENDAR ‚îÄ‚îÄ‚îÄ -->
        <div class="glass rounded-2xl shadow-xl p-6">
          <h2 class="text-brand font-bold text-lg mb-4 flex items-center gap-2">
            <span class="text-2xl">üìÖ</span> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
          </h2>
          <p class="text-xs text-gray-500 mb-4">
            * ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ
            <span
              class="inline-block w-3 h-3 rounded-full bg-accent align-middle"
            ></span>
            ‡∏Ñ‡∏∑‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß
          </p>

          <!-- Month nav -->
          <div class="flex items-center justify-between mb-4">
            <button
              id="prevMonth"
              onclick="changeMonth(-1)"
              class="w-8 h-8 rounded-full bg-brand-light text-brand font-bold text-lg hover:bg-brand hover:text-white transition"
            >
              ‚Äπ
            </button>
            <span id="monthLabel" class="font-semibold text-gray-700"></span>
            <button
              id="nextMonth"
              onclick="changeMonth(1)"
              class="w-8 h-8 rounded-full bg-brand-light text-brand font-bold text-lg hover:bg-brand hover:text-white transition"
            >
              ‚Ä∫
            </button>
          </div>

          <!-- Day headers -->
          <div class="grid grid-cols-7 mb-1">
            <div class="text-center text-xs font-semibold text-red-400 py-1">
              ‡∏≠‡∏≤
            </div>
            <div class="text-center text-xs font-semibold text-gray-400 py-1">
              ‡∏à
            </div>
            <div class="text-center text-xs font-semibold text-gray-400 py-1">
              ‡∏≠
            </div>
            <div class="text-center text-xs font-semibold text-gray-400 py-1">
              ‡∏û
            </div>
            <div class="text-center text-xs font-semibold text-gray-400 py-1">
              ‡∏û‡∏§
            </div>
            <div class="text-center text-xs font-semibold text-gray-400 py-1">
              ‡∏®
            </div>
            <div class="text-center text-xs font-semibold text-blue-400 py-1">
              ‡∏™
            </div>
          </div>

          <!-- Calendar grid -->
          <div class="relative">
            <div id="calGrid" class="grid grid-cols-7 gap-1"></div>
            <!-- Calendar loading overlay -->
            <div id="calLoadingOverlay" class="loading-overlay hide">
              <div class="spinner"></div>
              <span class="text-xs text-brand font-medium"
                >‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á...</span
              >
            </div>
          </div>

          <!-- Selected date pill -->
          <div id="selectedDatePill" class="hidden mt-4 text-center">
            <span
              class="inline-flex items-center gap-2 bg-brand text-white text-sm rounded-full px-4 py-1.5 font-medium shadow"
            >
              <span>üìÖ</span> <span id="selectedDateText"></span>
            </span>
          </div>
        </div>

        <!-- ‚îÄ‚îÄ‚îÄ RIGHT: FORM ‚îÄ‚îÄ‚îÄ -->
        <div class="glass rounded-2xl shadow-xl p-6">
          <h2 class="text-brand font-bold text-lg mb-5 flex items-center gap-2">
            <span class="text-2xl">üìù</span> ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≠‡∏á
          </h2>

          <form id="bookingForm" onsubmit="submitForm(event)" class="space-y-4">
            <!-- Dropdown loading bar -->
            <div
              id="dropdownLoadingBar"
              class="hidden flex items-center gap-2 text-xs text-brand bg-brand-light rounded-xl px-4 py-2"
            >
              <div
                class="spinner"
                style="width: 16px; height: 16px; border-width: 2px"
              ></div>
              <span>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheet...</span>
            </div>
            <!-- ‡∏Ñ‡∏≠‡∏£‡πå‡∏™ skeleton -->
            <div id="skeletonCourse" class="hidden">
              <div class="skeleton w-full"></div>
            </div>
            <!-- ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà skeleton -->
            <div id="skeletonLocation" class="hidden">
              <div class="skeleton w-full"></div>
            </div>
            <!-- ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (readonly ‚Äî set by calendar) -->
            <div>
              <label class="block text-sm font-semibold text-gray-600 mb-1"
                >‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ô <span class="text-red-400">*</span></label
              >
              <input
                id="fieldDate"
                name="date"
                type="text"
                readonly
                placeholder="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ö‡∏ô‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô ‚Üí"
                class="w-full border border-gray-200 rounded-xl px-4 py-2.5 bg-brand-light/50 text-brand font-semibold cursor-default text-sm"
              />
            </div>

            <!-- ‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡πÄ‡∏£‡∏µ‡∏¢‡∏ô -->
            <div>
              <label class="block text-sm font-semibold text-gray-600 mb-1"
                >‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡πÄ‡∏£‡∏µ‡∏¢‡∏ô <span class="text-red-400">*</span></label
              >
              <div class="relative">
                <select
                  id="fieldCourse"
                  name="course"
                  required
                  class="w-full appearance-none border border-gray-200 rounded-xl px-4 py-2.5 bg-white text-sm text-gray-700 focus:border-brand transition pr-10"
                >
                  <option value="" disabled selected>-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≠‡∏£‡πå‡∏™ --</option>
                  <!-- Loaded from Google Sheet (or default list below) -->
                </select>
                <div
                  class="pointer-events-none absolute inset-y-0 right-3 flex items-center text-gray-400"
                >
                  ‚ñæ
                </div>
              </div>
            </div>

            <!-- ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ô -->
            <div>
              <label class="block text-sm font-semibold text-gray-600 mb-1"
                >‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ô <span class="text-red-400">*</span></label
              >
              <div class="relative">
                <select
                  id="fieldLocation"
                  name="location"
                  required
                  class="w-full appearance-none border border-gray-200 rounded-xl px-4 py-2.5 bg-white text-sm text-gray-700 focus:border-brand transition pr-10"
                >
                  <option value="" disabled selected>-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà --</option>
                </select>
                <div
                  class="pointer-events-none absolute inset-y-0 right-3 flex items-center text-gray-400"
                >
                  ‚ñæ
                </div>
              </div>
            </div>

            <!-- ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á -->
            <div>
              <label class="block text-sm font-semibold text-gray-600 mb-1"
                >‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á <span class="text-red-400">*</span></label
              >
              <input
                id="fieldParent"
                name="parent"
                type="text"
                required
                placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á"
                class="w-full border border-gray-200 rounded-xl px-4 py-2.5 bg-white text-sm text-gray-700 focus:border-brand transition"
              />
            </div>

            <!-- ‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô -->
            <div>
              <label class="block text-sm font-semibold text-gray-600 mb-1"
                >‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô <span class="text-red-400">*</span></label
              >
              <input
                id="fieldStudent"
                name="student"
                type="text"
                required
                placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô"
                class="w-full border border-gray-200 rounded-xl px-4 py-2.5 bg-white text-sm text-gray-700 focus:border-brand transition"
              />
            </div>

            <!-- ‡∏≠‡∏≤‡∏¢‡∏∏‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô -->
            <div>
              <label class="block text-sm font-semibold text-gray-600 mb-1"
                >‡∏≠‡∏≤‡∏¢‡∏∏‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô <span class="text-red-400">*</span></label
              >
              <input
                id="fieldAge"
                name="age"
                type="number"
                min="1"
                max="25"
                required
                placeholder="‡∏≠‡∏≤‡∏¢‡∏∏ (‡∏õ‡∏µ)"
                class="w-full border border-gray-200 rounded-xl px-4 py-2.5 bg-white text-sm text-gray-700 focus:border-brand transition"
              />
            </div>

            <!-- Submit -->
            <button
              type="submit"
              id="submitBtn"
              class="w-full bg-brand hover:bg-brand-dark active:scale-95 text-white font-bold rounded-xl py-3 mt-2 transition text-base shadow-lg shadow-brand/30"
            >
              <span id="submitLabel">üöÄ ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏à‡∏≠‡∏á‡∏Ñ‡∏≠‡∏£‡πå‡∏™</span>
              <span id="submitSpinner" class="hidden">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...</span>
            </button>
          </form>
        </div>
      </div>

      <!-- ‚îÄ‚îÄ‚îÄ BOOKING SUMMARY TABLE ‚îÄ‚îÄ‚îÄ -->
      <!-- <div class="mt-8 glass rounded-2xl shadow-xl p-6 overflow-x-auto">
        <h2 class="text-brand font-bold text-lg mb-4 flex items-center gap-2">
          <span class="text-2xl">üìã</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß (session ‡∏ô‡∏µ‡πâ)
        </h2>
        <table class="w-full text-sm">
          <thead>
            <tr class="bg-brand-light text-brand">
              <th class="px-3 py-2 rounded-l-lg text-left">#</th>
              <th class="px-3 py-2 text-left">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
              <th class="px-3 py-2 text-left">‡∏Ñ‡∏≠‡∏£‡πå‡∏™</th>
              <th class="px-3 py-2 text-left">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</th>
              <th class="px-3 py-2 text-left">‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á</th>
              <th class="px-3 py-2 text-left">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
              <th class="px-3 py-2 text-left">‡∏≠‡∏≤‡∏¢‡∏∏</th>
              <th class="px-3 py-2 rounded-r-lg text-left">‡∏•‡∏ö</th>
            </tr>
          </thead>
          <tbody id="summaryTable" class="divide-y divide-gray-100">
            <tr id="emptyRow">
              <td colspan="8" class="text-center text-gray-400 py-6">
                ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
              </td>
            </tr>
          </tbody>
        </table>
      </div> -->
    </main>

    <!-- Toast -->
    <div
      id="toast"
      class="toast hide rounded-xl shadow-2xl px-5 py-3 text-sm font-medium text-white max-w-xs"
    ></div>

    <!-- ‚îÄ‚îÄ‚îÄ CONFIRM MODAL ‚îÄ‚îÄ‚îÄ -->
    <div
      id="confirmModal"
      class="fixed inset-0 z-50 flex items-center justify-center hidden"
    >
      <!-- Backdrop -->
      <div
        class="absolute inset-0 bg-black/40 backdrop-blur-sm"
        onclick="closeConfirm()"
      ></div>
      <!-- Modal box -->
      <div
        class="relative glass rounded-2xl shadow-2xl p-6 w-full max-w-sm mx-4 fade-in"
      >
        <h3 class="text-brand font-bold text-lg mb-4 flex items-center gap-2">
          <span class="text-2xl">üìã</span> ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á
        </h3>
        <div class="space-y-2 text-sm mb-5" id="confirmDetails"></div>
        <div class="flex gap-3">
          <button
            onclick="closeConfirm()"
            class="flex-1 border border-gray-200 rounded-xl py-2.5 font-semibold text-gray-500 hover:bg-gray-50 transition"
          >
            ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
          </button>
          <button
            onclick="confirmSubmit()"
            class="flex-1 bg-brand hover:bg-brand-dark text-white font-bold rounded-xl py-2.5 transition shadow-lg shadow-brand/30"
          >
            ‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏à‡∏≠‡∏á
          </button>
        </div>
      </div>
    </div>

    <!-- ‚îÄ‚îÄ‚îÄ SCRIPT ‚îÄ‚îÄ‚îÄ -->
    <script>
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      //  ‚öôÔ∏è  CONFIGURATION ‚Äî ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡πà‡∏≤‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      const APPS_SCRIPT_URL =
        "https://script.google.com/macros/s/AKfycbxReDzQFDOr3NVhns5pFn31Fz7F0IxuqYzn9M8wHjojyIeje-9l4dT-GsZeGlU7bGqp/exec";
      // ^ ‡∏ß‡∏≤‡∏á URL ‡∏Ç‡∏≠‡∏á Google Apps Script Web App ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà

      // ‚îÄ‚îÄ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• dropdown (fallback ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏° Google Sheet)
      const DEFAULT_COURSES = ["‡∏õ‡∏≤‡∏£‡πå‡∏Å‡∏±‡∏ß", "‡∏¢‡∏¥‡∏°‡∏ô‡∏±‡∏™‡∏ï‡∏¥‡∏Å"];
      const DEFAULT_LOCATIONS = ["‡∏¢‡∏¥‡∏°‡∏ß‡∏±‡∏î‡∏™‡∏∞‡πÅ‡∏Å‡πâ"];
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

      // ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÇ‡∏´‡∏•‡∏î‡∏°‡∏≤‡∏à‡∏≤‡∏Å Google Sheet (‡∏´‡∏£‡∏∑‡∏≠ fallback)
      let availableCourses = [...DEFAULT_COURSES];
      let availableLocations = [...DEFAULT_LOCATIONS];

      // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ POPULATE DROPDOWNS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      function populateSelect(id, items) {
        const sel = document.getElementById(id);
        const first = sel.options[0];
        sel.innerHTML = "";
        sel.appendChild(first);
        items.forEach((v) => {
          const o = document.createElement("option");
          o.value = v;
          o.textContent = v;
          sel.appendChild(o);
        });
      }

      function initDropdowns() {
        populateSelect("fieldCourse", availableCourses);
        populateSelect("fieldLocation", availableLocations);
      }

      // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ LOADING HELPERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      function setCalendarLoading(on) {
        const overlay = document.getElementById("calLoadingOverlay");
        if (on) overlay.classList.remove("hide");
        else overlay.classList.add("hide");
      }

      function setDropdownLoading(on) {
        document
          .getElementById("dropdownLoadingBar")
          .classList.toggle("hidden", !on);
        document
          .getElementById("skeletonCourse")
          .classList.toggle("hidden", !on);
        document
          .getElementById("skeletonLocation")
          .classList.toggle("hidden", !on);
        // hide/show actual selects
        const course = document
          .getElementById("fieldCourse")
          .closest("div.relative");
        const location = document
          .getElementById("fieldLocation")
          .closest("div.relative");
        course.classList.toggle("hidden", on);
        location.classList.toggle("hidden", on);
      }

      // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ LOAD FROM GOOGLE SHEET ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      // Calls the Apps Script GET endpoint for dropdown data
      async function loadDropdownsFromSheet() {
        setDropdownLoading(true);
        if (!APPS_SCRIPT_URL.includes("YOUR_SCRIPT_ID")) {
          try {
            const res = await fetch(APPS_SCRIPT_URL + "?action=getDropdowns");
            const data = await res.json();
            if (data.courses && data.courses.length)
              availableCourses = data.courses;
            if (data.locations && data.locations.length)
              availableLocations = data.locations;
          } catch (e) {
            console.warn("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î dropdown ‡∏à‡∏≤‡∏Å Sheet:", e);
          }
        }
        initDropdowns();
        setDropdownLoading(false);
      }

      // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ LOAD EXISTING BOOKINGS FROM SHEET ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      async function loadBookingsFromSheet() {
        if (APPS_SCRIPT_URL.includes("YOUR_SCRIPT_ID")) return;
        setCalendarLoading(true);
        try {
          const res = await fetch(APPS_SCRIPT_URL + "?action=getBookings");
          const data = await res.json();
          if (data.bookingsByDate) {
            Object.assign(bookingsByDate, data.bookingsByDate);
            renderCalendar();
          }
        } catch (e) {
          console.warn("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏à‡∏≤‡∏Å Sheet:", e);
        } finally {
          setCalendarLoading(false);
        }
      }

      // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ CALENDAR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      const NOW = new Date();
      let calYear = NOW.getFullYear();
      let calMonth = NOW.getMonth(); // 0-indexed

      const THAI_MONTHS = [
        "‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°",
        "‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå",
        "‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°",
        "‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô",
        "‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°",
        "‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô",
        "‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°",
        "‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°",
        "‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô",
        "‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°",
        "‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô",
        "‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°",
      ];

      let selectedDate = null;
      let bookingsByDate = {}; // key: "YYYY-MM-DD", value: booking count

      const THAI_DAYS = [
        "‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå",
        "‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå",
        "‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£",
        "‡∏û‡∏∏‡∏ò",
        "‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ",
        "‡∏®‡∏∏‡∏Å‡∏£‡πå",
        "‡πÄ‡∏™‡∏≤‡∏£‡πå",
      ];

      function dateToKey(d) {
        return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, "0")}-${String(d.getDate()).padStart(2, "0")}`;
      }

      function renderCalendar() {
        const label = document.getElementById("monthLabel");
        label.textContent = `${THAI_MONTHS[calMonth]} ${calYear + 543}`;

        const grid = document.getElementById("calGrid");
        grid.innerHTML = "";

        const firstDay = new Date(calYear, calMonth, 1).getDay(); // 0=Sun
        const daysInMonth = new Date(calYear, calMonth + 1, 0).getDate();

        // blank cells before first day
        for (let i = 0; i < firstDay; i++) {
          const blank = document.createElement("div");
          grid.appendChild(blank);
        }

        const today = new Date();
        today.setHours(0, 0, 0, 0);

        for (let d = 1; d <= daysInMonth; d++) {
          const date = new Date(calYear, calMonth, d);
          const dow = date.getDay(); // 0=Sun, 6=Sat
          const isWeekend = dow === 0 || dow === 6;
          const isPast = date < today;
          const isToday = date.getTime() === today.getTime();
          const isSel =
            selectedDate && date.getTime() === selectedDate.getTime();
          const dateKey = dateToKey(date);
          const count = bookingsByDate[dateKey] || 0;

          const btn = document.createElement("button");
          btn.type = "button";
          btn.className = [
            "day-btn w-full aspect-square rounded-lg text-xs font-medium transition flex flex-col items-center justify-center gap-0",
            isWeekend ? "text-brand font-semibold" : "text-gray-700",
            isToday ? "today-mark" : "",
            isSel ? "selected" : "",
          ].join(" ");

          const numSpan = document.createElement("span");
          numSpan.textContent = d;
          btn.appendChild(numSpan);

          if (count > 0) {
            const badge = document.createElement("span");
            badge.className = "booking-badge";
            badge.textContent = count;
            btn.appendChild(badge);
          }

          if (isPast) btn.disabled = true;

          btn.addEventListener("click", () => selectDate(date));
          grid.appendChild(btn);
        }
      }

      function changeMonth(dir) {
        calMonth += dir;
        if (calMonth > 11) {
          calMonth = 0;
          calYear++;
        }
        if (calMonth < 0) {
          calMonth = 11;
          calYear--;
        }
        renderCalendar();
      }

      function selectDate(date) {
        selectedDate = date;

        // Fill hidden input
        const fmt = formatDate(date);
        document.getElementById("fieldDate").value = fmt;

        // Update pill
        document.getElementById("selectedDateText").textContent = fmt;
        document.getElementById("selectedDatePill").classList.remove("hidden");

        renderCalendar(); // re-render to highlight
      }

      function formatDate(d) {
        const dd = String(d.getDate()).padStart(2, "0");
        const mm = String(d.getMonth() + 1).padStart(2, "0");
        const yyyy = d.getFullYear() + 543;
        return `${dd}/${mm}/${yyyy}`;
      }

      // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ FORM SUBMIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      let bookingCount = 0;
      let pendingPayload = null;

      async function submitForm(e) {
        e.preventDefault();

        if (!selectedDate) {
          showToast("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏à‡∏≤‡∏Å‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô", "bg-yellow-500");
          return;
        }

        pendingPayload = {
          date: document.getElementById("fieldDate").value,
          course: document.getElementById("fieldCourse").value,
          day: THAI_DAYS[selectedDate.getDay()],
          location: document.getElementById("fieldLocation").value,
          parent: document.getElementById("fieldParent").value.trim(),
          student: document.getElementById("fieldStudent").value.trim(),
          age: document.getElementById("fieldAge").value,
          timestamp: new Date().toLocaleString("th-TH"),
          dateKey: dateToKey(selectedDate),
        };

        // Show confirmation modal
        document.getElementById("confirmDetails").innerHTML = `
          <div class="flex justify-between border-b border-gray-100 pb-1"><span class="text-gray-500">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</span><span class="font-semibold text-brand">${pendingPayload.date}</span></div>
          <div class="flex justify-between border-b border-gray-100 pb-1"><span class="text-gray-500">‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</span><span class="font-semibold">${pendingPayload.day}</span></div>
          <div class="flex justify-between border-b border-gray-100 pb-1"><span class="text-gray-500">‡∏Ñ‡∏≠‡∏£‡πå‡∏™</span><span class="font-semibold">${pendingPayload.course}</span></div>
          <div class="flex justify-between border-b border-gray-100 pb-1"><span class="text-gray-500">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</span><span class="font-semibold">${pendingPayload.location}</span></div>
          <div class="flex justify-between border-b border-gray-100 pb-1"><span class="text-gray-500">‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á</span><span class="font-semibold">${pendingPayload.parent}</span></div>
          <div class="flex justify-between border-b border-gray-100 pb-1"><span class="text-gray-500">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</span><span class="font-semibold">${pendingPayload.student}</span></div>
          <div class="flex justify-between"><span class="text-gray-500">‡∏≠‡∏≤‡∏¢‡∏∏</span><span class="font-semibold">${pendingPayload.age} ‡∏õ‡∏µ</span></div>
        `;
        document.getElementById("confirmModal").classList.remove("hidden");
      }

      function closeConfirm() {
        document.getElementById("confirmModal").classList.add("hidden");
        pendingPayload = null;
      }

      async function confirmSubmit() {
        document.getElementById("confirmModal").classList.add("hidden");
        const payload = pendingPayload;
        pendingPayload = null;

        // UI loading
        document.getElementById("submitLabel").classList.add("hidden");
        document.getElementById("submitSpinner").classList.remove("hidden");
        document.getElementById("submitBtn").disabled = true;

        try {
          if (!APPS_SCRIPT_URL.includes("YOUR_SCRIPT_ID")) {
            await fetch(APPS_SCRIPT_URL, {
              method: "POST",
              mode: "no-cors",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ ...payload, action: "addBooking" }),
            });
          }

          // Show success
          document.getElementById("successBanner").classList.remove("hidden");
          document
            .getElementById("successBanner")
            .scrollIntoView({ behavior: "smooth" });
          showToast("‚úÖ ‡∏à‡∏≠‡∏á‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!", "bg-green-600");

          // Add to local summary table
          bookingCount++;
          addSummaryRow(bookingCount, payload);

          // Track booking count per date for calendar badges
          bookingsByDate[payload.dateKey] =
            (bookingsByDate[payload.dateKey] || 0) + 1;

          // Reset form
          document.getElementById("bookingForm").reset();
          selectedDate = null;
          document.getElementById("selectedDatePill").classList.add("hidden");
          renderCalendar();

          setTimeout(
            () =>
              document.getElementById("successBanner").classList.add("hidden"),
            6000,
          );
        } catch (err) {
          showToast("‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà", "bg-red-500");
          console.error(err);
        } finally {
          document.getElementById("submitLabel").classList.remove("hidden");
          document.getElementById("submitSpinner").classList.add("hidden");
          document.getElementById("submitBtn").disabled = false;
        }
      }

      function addSummaryRow(n, p) {
        const tbody = document.getElementById("summaryTable");
        if (!tbody) return; // table is hidden/commented out
        const empty = document.getElementById("emptyRow");
        if (empty) empty.remove();
        const rowId = "row-" + n;
        const tr = document.createElement("tr");
        tr.id = rowId;
        tr.className = "hover:bg-brand-light/40 transition";
        tr.innerHTML = `
          <td class="px-3 py-2 text-gray-400">${n}</td>
          <td class="px-3 py-2 font-medium text-brand">${p.date}</td>
          <td class="px-3 py-2">${p.course}</td>
          <td class="px-3 py-2">${p.location}</td>
          <td class="px-3 py-2">${p.parent}</td>
          <td class="px-3 py-2">${p.student}</td>
          <td class="px-3 py-2">${p.age} ‡∏õ‡∏µ</td>
          <td class="px-3 py-2">
            <button onclick="deleteRow('${rowId}','${p.dateKey}')" class="text-red-400 hover:text-red-600 text-xs font-bold transition px-1" title="‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£">‚úï</button>
          </td>
        `;
        tbody.appendChild(tr);
      }

      function deleteRow(rowId, key) {
        const tr = document.getElementById(rowId);
        if (tr) tr.remove();
        if (key && bookingsByDate[key]) {
          bookingsByDate[key] = Math.max(0, bookingsByDate[key] - 1);
          if (bookingsByDate[key] === 0) delete bookingsByDate[key];
        }
        renderCalendar();
        const tbody = document.getElementById("summaryTable");
        if (!tbody) return;
        if (tbody.children.length === 0) {
          const empty = document.createElement("tr");
          empty.id = "emptyRow";
          empty.innerHTML =
            '<td colspan="8" class="text-center text-gray-400 py-6">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</td>';
          tbody.appendChild(empty);
        }
      }

      // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      function showToast(msg, colorClass) {
        const t = document.getElementById("toast");
        t.textContent = msg;
        t.className = `toast rounded-xl shadow-2xl px-5 py-3 text-sm font-medium text-white max-w-xs ${colorClass}`;
        t.classList.remove("hide");
        setTimeout(() => t.classList.add("hide"), 3500);
      }

      // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      renderCalendar();
      loadDropdownsFromSheet();
      loadBookingsFromSheet();
    </script>
  </body>
</html>
